#include<miracl.h>
#include<string.h>
#include"sm2.h"
#define MAX 500
int main(){
	
	unsigned char M[MAX];
	memset(M, 0, MAX);
	FILE * fp;
	int i = 0;
	fopen_s(&fp, "1.txt", "r");
	fread_s(M, MAX, sizeof(char), MAX, fp);
	printf("**********   Plaintext   **********\n\n");
	printf("%s", M);


	unsigned char dB[32] = { '\0' };//{ 0x16,0x49,0xAB,0x77,0xA0,0x06,0x37,0xBD,0x5E,0x2E,0xFE,0x28,0x3F,0xBF,0x35,0x35,0x34,0xAA,0x7F,0x7C,0xB8,0x94,0x63,0xF2,0x08,0xDD,0xBC,0x29,0x20,0xBB,0x0D,0xA0 };
	unsigned char xB[32] = { '\0' };//{ 0x43,0x5B,0x39,0xCC,0xA8,0xF3,0xB5,0x08,0xC1,0x48,0x8A,0xFC,0x67,0xBE,0x49,0x1A,0x0F,0x7B,0xA0,0x7E,0x58,0x1A,0x0E,0x48,0x49,0xA5,0xCF,0x70,0x62,0x8A,0x7E,0x0A };
	unsigned char yB[32] = { '\0' };//{ 0x75,0xDD,0xBA,0x78,0xF1,0x5F,0xEE,0xCB,0x4C,0x78,0x95,0xE2,0xC1,0xCD,0xF5,0xFE,0x01,0xDE,0xBB,0x2C,0xDB,0xAD,0xF4,0x53,0x99,0xCC,0xF7,0x7B,0xBA,0x07,0x6A,0x42 };
	
	unsigned char MM[MAX] = { 0 }, MMM[MAX] = { 0 };
	int wxlen, wylen, pklen;
	
	sm2_keygen(xB, &wxlen, yB, &wylen, dB, &pklen);
	printf("\n\n**********    Privkey    **********\n\n");
	do {
		printf("%02X", dB[i]);
		i++;
	} while (dB[i] != '\0'||dB[i + 1] != '\0');



	printf("\n\n**********   Ciphertext  **********\n\n");
	sm2_encrypt(M, strlen((char*)M), xB, 32, yB, 32, MM);
	//printf(MM, 64 + strlen((char*)M) + 32);
	i = 0;
	do {
		printf("%02X", MM[i]);
		i++;
	} while (MM[i] != '\0'||MM[i + 1] != '\0'||MM[i+2]!=0);
	printf("\n\n**********   Plaintext   **********\n\n");
	sm2_decrypt(MM, 64 + strlen((char*)M) + 32, dB, 32, MMM);
	printf(MMM, strlen((char*)M));
	printf("\n\n**********     Over!     **********\n\n");
	system("pause");
	return 0;
}